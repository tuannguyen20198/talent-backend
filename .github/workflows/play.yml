name: Build and Deploy

on:
  push:
    branches:
      - main
      - master

jobs:
  build-and-deploy-sso:
    name: Build and Deploy SSO Service
    runs-on: ubuntu-latest
    env:
      DATABASE_URL_SSO: ${{ secrets.DATABASE_URL_SSO }}
      JWT_SECRET_SSO: ${{ secrets.JWT_SECRET_SSO }}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Use Node.js 22.x
        uses: actions/setup-node@v3
        with:
          node-version: 22

      - name: Install dependencies (SSO)
        run: pnpm install

      - name: Build SSO service
        run: pnpm start:dev:sso

        env:
          SSO_DATABASE_URL: ${{ secrets.SSO_DATABASE_URL }}
          SSO_JWT_SECRET: ${{ secrets.SSO_JWT_SECRET }}

  build-and-deploy-talent:
    name: Build and Deploy Talent Service
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Use Node.js 22.x
        uses: actions/setup-node@v3
        with:
          node-version: 22

      - name: Install dependencies (Talent)
        run: pnpm install

      - name: Build Talent service
        run: pnpm start:dev:talent

        env:
          TALENT_DATABASE_URL: ${{ secrets.TALENT_DATABASE_URL }}
