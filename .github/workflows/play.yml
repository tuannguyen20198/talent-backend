name: Build and Deploy SSO

on:
  push:
    branches:
      - main
jobs:
  build-and-deploy-sso:
    name: Build & Deploy SSO Service
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§¾ Checkout repository
        uses: actions/checkout@v3

      - name: âš™ï¸ Setup Node.js 22.x
        uses: actions/setup-node@v3
        with:
          node-version: 22

      - name: ğŸ“¦ Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: ğŸ“¥ Install dependencies (sso only)
        run: pnpm install --filter @apps/sso-service...

      - name: ğŸ› ï¸ Build SSO service
        run: pnpm build --filter @apps/sso-service...

      - name: ğŸ”„ Run Prisma migrate (deploy)
        run: pnpm prisma:deploy:sso
        env:
          # GÃ¡n biáº¿n mÃ´i trÆ°á»ng tá»« GitHub Secrets
          DATABASE_URL: ${{ secrets.SSO_DATABASE_URL }}

      # Tuá»³ chá»n: Start production (náº¿u self-host)
      # - name: ğŸš€ Start SSO service (prod)
      #   run: pnpm start:prod --filter @apps/sso-service
      #   env:
      #     NODE_ENV: production
      #     DATABASE_URL: ${{ secrets.SSO_DATABASE_URL }}

      # Hoáº·c deploy lÃªn server
      # - name: ğŸš€ Deploy to production
      #   run: ./scripts/deploy-sso.sh
      #   env:
      #     DEPLOY_SSH_KEY: ${{ secrets.DEPLOY_SSH_KEY }}
